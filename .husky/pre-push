#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

echo "Running checks before push..."

# Frontend checks
echo "Checking frontend..."
cd frontend || exit 1

# Use fnm if available
if command -v fnm >/dev/null 2>&1; then
    fnm use 22 || echo "Warning: fnm not available, using system Node"
fi

# Run ESLint
echo "Running ESLint..."
npm run lint || {
    echo "ESLint failed! Fix linting errors before pushing."
    exit 1
}

# Build frontend
echo "Building frontend..."
npm run build || {
    echo "Frontend build failed! Fix build errors before pushing."
    exit 1
}

# Go back to root
cd ..

echo "Checking Go backend..."

# Run Go tests
echo "Running Go tests..."
go test ./... || {
    echo "Go tests failed! Fix failing tests before pushing."
    exit 1
}

# Build Go app
echo "Building Go backend..."
go build -o /tmp/united-app-test ./... || {
    echo "Go build failed! Fix build errors before pushing."
    exit 1
}

echo "All checks passed! Pushing to remote..."